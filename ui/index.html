<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Brobot Hub Control</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #111; color: #eee; }
    input, textarea, select, button { margin: 6px 0; padding: 6px; width: 100%; }
    section { margin-bottom: 24px; border-bottom: 1px solid #333; padding-bottom: 16px; }
    h1, h3 { color: #f0c674; }
    #messageBox { margin-top: 16px; color: #98ec9b; font-weight: bold; }
  </style>
</head>
<body>
  <h1 id="hubName">Loading...</h1>

  <section>
    <h3>Create New Task</h3>
    <input id="taskTitle" placeholder="Title" />
    <input id="taskNotes" placeholder="Notes" />
    <select id="taskPriority">
      <option value="low">Low</option>
      <option value="medium" selected>Medium</option>
      <option value="high">High</option>
    </select>
    <input id="taskDue" type="date" />
    <button onclick="submitTask()">Submit Task</button>
  </section>

  <section>
    <h3>Move Task</h3>
    <input id="moveTitle" placeholder="Task Title" />
    <select id="newStatus">
      <option value="activeProjects">Active</option>
      <option value="pausedProjects">Paused</option>
      <option value="completedProjects">Completed</option>
    </select>
    <button onclick="moveTask()">Move</button>
  </section>

  <section>
    <h3>Log Entry</h3>
    <textarea id="logText" placeholder="What's the update?"></textarea>
    <select id="logType">
      <option value="journal">Journal</option>
      <option value="win">Win</option>
      <option value="update">Update</option>
    </select>
    <button onclick="submitLog()">Log It</button>
  </section>

  <div id="messageBox"></div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const hubID = params.get('hub')?.toUpperCase() || 'T';

    function showMessage(msg) {
      const box = document.getElementById('messageBox');
      box.innerText = msg;
      setTimeout(() => box.innerText = '', 4000);
    }

    async function submitTask() {
      const payload = {
        title: document.getElementById('taskTitle').value,
        notes: document.getElementById('taskNotes').value,
        priority: document.getElementById('taskPriority').value,
        dueDate: document.getElementById('taskDue').value || null
      };
      const res = await fetch(`/hub/${hubID}/task`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      showMessage(data.message || 'Task submitted.');
    }

    async function moveTask() {
      const payload = {
        title: document.getElementById('moveTitle').value,
        newStatus: document.getElementById('newStatus').value
      };
      const res = await fetch(`/hub/${hubID}/task/move`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      showMessage(data.message || 'Task moved.');
    }

    async function submitLog() {
      const payload = {
        type: document.getElementById('logType').value,
        content: document.getElementById('logText').value
      };
      const res = await fetch(`/hub/${hubID}/log`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      showMessage(data.message || 'Log saved.');
    }

    fetch(`/hub/${hubID}`)
      .then(res => res.json())
      .then(data => {
        document.getElementById('hubName').innerText = `[${hubID}] ${data.hub}`;
      })
      .catch(() => {
        document.getElementById('hubName').innerText = `[${hubID}] Hub not found`;
        showMessage('Error loading hub');
      });
  </script>
</body>
</html>
